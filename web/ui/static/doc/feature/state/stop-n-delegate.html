<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Stopping a delegate host</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="task">
      
      <meta name="DC.Title" content="Stopping a delegate host">
      
      <meta name="DC.Relation" scheme="URI" content="stop-n.html">
      
      <meta name="prodname" content="Control Center">
      
      <meta name="prodname" content="Control Center">
      
      <meta name="version" content="1">
      
      <meta name="version" content="1">
      
      <meta name="release" content="4">
      
      <meta name="release" content="4">
      
      <meta name="modification" content="0">
      
      <meta name="modification" content="0">
      
      <meta name="DC.Publisher" content="Zenoss, Inc.">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="taskid">
      <script type="text/javascript">var d4p = {"relativePath":"..\/..\/","dev":false,"debug":false,"draft":false,"nextTopicHref":"feature\/state\/start-n.html","previousTopicHref":"feature\/state\/stop-n-master.html","root":false,"map":{"chunked":false},"search":{"minlength":2},"l":{"searchPageHeading":"Search Results","close":"Close"}}</script>
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../themes/html5-zenoss/css/style.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection, print" src="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
      <script rel="stylesheet" type="text/css" media="screen, projection, print" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../themes/html5-zenoss/js/script.js"></script>
      </head>
   <body class="en-us html5-zenoss centered navigation-default">
      <ul id="page-links" class="hidden sr-only">
         <li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li>
         <li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li>
         <li><a id="skip-to-footer" href="#footer">Skip to footer</a></li>
      </ul>
      <header id="site-head" class="header header--fixed">
         <nav id="topNav" class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">
               <div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="#">  Control Center Reference Guide  </a></div>
               <form id="search" class="navbar-form navbar-right hidden-xs" role="search">
                  <div class="form-group"><input id="search-text" type="text" class="form-control" placeholder="Search"></div>
               </form>
               <ul class="nav navbar-nav navbar-right hidden-xs"></ul>
            </div>
         </nav>
         <div id="msg-version"></div>
      </header>
      <div class="container">
         <div class="row">
            <div class="col-xs-12 col-md-21">
               <ol class="breadcrumb">
                  <li><a class="breadcrumb" href="../../book/help/maps/admin.html" title="Administration reference">Administration reference</a></li>
                  
                  <li><a class="breadcrumb" href="../../feature/state/intro.html" title="Stopping and starting Control Center">Stopping and starting Control Center</a></li>
                  
                  <li><a class="breadcrumb" href="../../feature/state/stop-n.html" title="Stopping Control Center (multi-host deployment)">Stopping Control Center (multi-host deployment)</a></li>
                  
                  <li>Stopping a delegate host</li>
               </ol>
            </div>
         </div>
         <div class="row">
            <div class="col-xs-6 col-md-4 hidden-xs">
               <nav id="side-navigation" class="bs-docs-sidebar hidden-print hidden-xs">
                  <ul class="nav bs-docs-sidenav">
                     <li class=" no-child "><a href="../../book/help/front/about.html">About this guide</a></li>
                     <li class=" collapsible  collapsed"><a href="../../book/help/gui/gui.html"><span class="enumeration enumeration0">Chapter 1. </span>Browser interface overview</a><ul class="nav">
                           <li class=" no-child "><a href="../../book/help/gui/nav-menubar.html">Main menu and navigation</a></li>
                           <li class=" collapsible  collapsed"><a href="../../book/help/gui/app.html">Applications page</a><ul class="nav">
                                 <li class=" no-child "><a href="../../book/help/gui/internal-svcs.html">Internal Services details</a></li>
                                 <li class=" collapsible  collapsed"><a href="../../book/help/gui/app-detail.html">Application details</a><ul class="nav">
                                       <li class=" no-child "><a href="../../book/help/gui/app-detail-ip-assign.html">IP Assignments</a></li>
                                       <li class=" no-child "><a href="../../book/help/gui/app-detail-config.html">Configuration Files</a></li>
                                       <li class=" no-child "><a href="../../book/help/gui/app-detail-services.html">Services</a></li>
                                       <li class=" no-child "><a href="../../book/help/gui/app-detail-schedule.html">Scheduled Tasks table</a></li>
                                    </ul>
                                 </li>
                              </ul>
                           </li>
                           <li class=" no-child "><a href="../../book/help/gui/pools.html">Resource Pools page</a></li>
                           <li class=" collapsible  collapsed"><a href="../../book/help/gui/hosts.html">Hosts page</a><ul class="nav">
                                 <li class=" no-child "><a href="../../book/help/gui/hosts-details.html">Host details</a></li>
                              </ul>
                           </li>
                           <li class=" no-child "><a href="../../book/help/gui/logs.html">Logs page</a></li>
                           <li class=" no-child "><a href="../../book/help/gui/backup-restore-page.html">Backup/Restore page</a></li>
                        </ul>
                     </li>
                     <li class=" collapsible  collapsed"><a href="../../book/help/maps/cli.html"><span class="enumeration enumeration0">Chapter 2. </span>Command-line interface reference</a><ul class="nav">
                           <li class=" no-child "><a href="../../feature/cli/invoking-serviced.html">Invoking serviced</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced.html">serviced</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-backup.html">serviced backup</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-docker.html">serviced docker</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-host.html">serviced host</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-key.html">serviced key</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-log-export.html">serviced log export</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-pool.html">serviced pool</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-restore.html">serviced restore</a></li>
                           <li class=" no-child "><a href="../../feature/cli/script.html">serviced script</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-service.html">serviced service</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-snapshot.html">serviced snapshot</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-storage.html">serviced-storage</a></li>
                           <li class=" no-child "><a href="../../feature/vars/file.html">Control Center configuration file</a></li>
                        </ul>
                     </li>
                     <li class=" collapsible  active"><a href="../../book/help/maps/admin.html"><span class="enumeration enumeration0">Chapter 3. </span>Administration reference</a><ul class="nav">
                           <li class=" collapsible  collapsed"><a href="../../feature/storage/thinpool-minimums.html">Control Center application data storage requirements</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/storage/thinpool-examine.html">Examining application data storage status</a></li>
                                 <li class=" no-child "><a href="../../feature/storage/resize-meta.html">Adding space to the metadata area of a Control Center thin pool</a></li>
                                 <li class=" no-child "><a href="../../feature/storage/resize-data.html">Adding space to the data area of a Control Center thin pool</a></li>
                                 <li class=" no-child "><a href="../../feature/storage/resize-tenant-vd.html">Adding space to a tenant volume</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/state/emergency-shutdown.html">Emergency shutdown of services</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/state/emergency-clear.html">Resetting emergency shutdown flags</a></li>
                              </ul>
                           </li>
                           <li class=" no-child "><a href="../../feature/nat/overview.html">Using Control Center with a NAT device</a></li>
                           <li class=" collapsible  collapsed"><a href="../../feature/backup/overview.html">Backing up and restoring</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/backup/best-practice.html">Best practices for backup and restore</a></li>
                                 <li class=" no-child "><a href="../../feature/backup/backup.html">Backing up using the browser interface</a></li>
                                 <li class=" collapsible  collapsed"><a href="../../feature/backup/cli.html">Backing up using the CLI</a><ul class="nav">
                                       <li class=" no-child "><a href="../../feature/backup/cli-all.html">Backing up the entire system</a></li>
                                       <li class=" no-child "><a href="../../feature/backup/cli-exclude-one.html">Exclude one tenant volume from the backup</a></li>
                                       <li class=" no-child "><a href="../../feature/backup/cli-exclude-multiple.html">Exclude multiple tenant volumes from the backup</a></li>
                                    </ul>
                                 </li>
                                 <li class=" no-child "><a href="../../feature/backup/restore.html">Restoring from a backup</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/storage/snapshot-rollback.html">Creating snapshots and rolling back</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/storage/snapshot.html">Creating a snapshot</a></li>
                                 <li class=" no-child "><a href="../../feature/storage/rollback.html">Rolling back to a snapshot</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  active"><a href="../../feature/state/intro.html">Stopping and starting Control Center</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/state/stop-1.html">Stopping Control Center (single-host deployment)</a></li>
                                 <li class=" no-child "><a href="../../feature/state/start-1.html">Starting Control Center (single-host deployment)</a></li>
                                 <li class=" collapsible  active"><a href="../../feature/state/stop-n.html">Stopping Control Center (multi-host deployment)</a><ul class="nav">
                                       <li class=" no-child "><a href="../../feature/state/stop-n-master.html">Stopping a master host (multi-host deployment)</a></li>
                                       <li class=" no-child  active"><a class="selected" href="../../feature/state/stop-n-delegate.html">Stopping a delegate host</a></li>
                                    </ul>
                                 </li>
                                 <li class=" no-child "><a href="../../feature/state/start-n.html">Starting Control Center (multi-host deployment)</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/restart/overview.html">Rolling restart of services </a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/restart/modify.html">Changing rolling restart</a></li>
                              </ul>
                           </li>
                           <li class=" no-child "><a href="../../feature/audit/intro.html">Control Center audit logging</a></li>
                        </ul>
                     </li>
                     <li class=" collapsible  collapsed"><a href="#">Glossary</a><ul class="nav">
                           <li class=" no-child "><a href="../../shared/glossary/cc-application.html">application</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-cluster.html">cluster</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-delegate-host.html">delegate host</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-master-host.html">master host</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-resource-pool.html">resource pool</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-service.html">service</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/service-definition.html">service definition</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/service-template.html">service template</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-serviced.html">serviced</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-tenant.html">tenant</a></li>
                        </ul>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="col-xs-12 col-md-8">
               <div id="page" class="starter-template">
                  <article>
                     <div class="page task  - topic-topic task-task " id="taskid">
                        
                        <h1 class="title topictitle1">Stopping a delegate host</h1>
                        <div class="body taskbody">
                           
                           <div class="section context"><a name="taskid-d23555e35" id="taskid-d23555e35" class="anchor"></a>Use this procedure to stop the <span class="ph">Control Center</span> service
                              (<span class="keyword cmdname">serviced</span>) on a delegate host in a multi-host deployment. Repeat this
                              procedure on each delegate host in your deployment.
                           </div>
                           
                           
                           <ol class="ol steps">
                              <li class="li step stepexpand">
                                 <span class="ph cmd">Log in to the delegate host <span class="ph">as <samp class="ph codeph">root</samp>, or as a user with superuser privileges</span>.</span>
                                 
                              </li>
                              
                              <li class="li step stepexpand">
                                 <span class="ph cmd">Stop the <span class="ph">Control Center</span> service.</span>
                                 
                                 <div class="itemgroup stepxmp">
                                    <pre class="pre codeblock">systemctl stop serviced</pre>
                                    
                                    </div>
                                 
                              </li>
                              
                              <li class="li step stepexpand" id="taskid__stop-containers">
                                 <span class="ph cmd">Ensure that no containers remain in the local repository.</span>
                                 
                                 <ol type="a" class="ol substeps">
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Display the identifiers of all containers, running and exited.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">docker ps -qa</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the command returns no result, proceed to the next step.</li>
                                             
                                             
                                             <li class="li">If the command returns a result, perform the following substeps.</li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Remove all remaining containers.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">docker ps -qa | xargs --no-run-if-empty docker rm -fv</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the remove command completes, proceed to the next step.</li>
                                             
                                             
                                             <li class="li">If the remove command does not complete, the most likely cause is an NFS
                                                conflict. Perform the following substeps.
                                             </li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Stop the NFS and Docker services.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl stop nfs &amp;&amp; systemctl stop docker</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Start the NFS and Docker services.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl start nfs &amp;&amp; systemctl start docker</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Repeat the attempt to remove all remaining containers.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">docker ps -qa | xargs --no-run-if-empty docker rm -fv</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the remove command completes, proceed to the next step.</li>
                                             
                                             
                                             <li class="li">If the remove command does not complete, perform the remaining substeps.</li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Disable the automatic startup of <span class="keyword cmdname">serviced</span>.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl disable serviced</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Reboot the host.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">reboot</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Log in to the delegate host <span class="ph">as <samp class="ph codeph">root</samp>, or as a user with superuser privileges</span>.</span>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Enable the automatic startup of <span class="keyword cmdname">serviced</span>.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl enable serviced</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                 </ol>
                                 
                                 
                              </li>
                              
                              <li class="li step stepexpand" id="taskid__stop-nfs">
                                 <span class="ph cmd">Dismount all filesystems mounted from the <span class="ph">Control Center</span> master host.</span>
                                 
                                 <div class="itemgroup info">This step ensures no stale mounts remain when the storage on the
                                    master host is replaced.
                                 </div>
                                 
                                 <ol type="a" class="ol substeps">
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Identify filesystems mounted from the master host.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">awk '/serviced/ { print $1, $2 }' &lt; /proc/mounts \
  | grep -v '/opt/serviced/var/isvcs'</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the preceding command returns no result, stop. This procedure is complete.</li>
                                             
                                             
                                             <li class="li">If the preceding command returns a result, perform the following substeps.</li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Force the filesystems to dismount.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">for FS in $(awk '/serviced/ { print $2 }' &lt; /proc/mounts \
  | grep -v '/opt/serviced/var/isvcs')
do
  umount -f $FS
done</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Identify filesystems mounted from the master host.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">awk '/serviced/ { print $1, $2 }' &lt; /proc/mounts \
  | grep -v '/opt/serviced/var/isvcs'</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the preceding command returns no result, stop. This procedure is complete.</li>
                                             
                                             
                                             <li class="li">If the preceding command returns a result, perform the following substeps.</li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Perform a lazy dismount.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">for FS in $(awk '/serviced/ { print $2 }' &lt; /proc/mounts \
  | grep -v '/opt/serviced/var/isvcs')
do
  umount -f -l $FS
done</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Restart the NFS service.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl restart nfs</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Determine whether any filesystems remain mounted from the master host.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">awk '/serviced/ { print $1, $2 }' &lt; /proc/mounts \
  | grep -v '/opt/serviced/var/isvcs'</pre>
                                          
                                          </div>
                                       
                                       <div class="itemgroup stepresult">
                                          
                                          <ul class="ul">
                                             
                                             <li class="li">If the preceding command returns no result, stop. This procedure is complete.</li>
                                             
                                             
                                             <li class="li">If the preceding command returns a result, perform the remaining substeps.</li>
                                             
                                             
                                          </ul>
                                          
                                          
                                       </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Disable the automatic startup of <span class="keyword cmdname">serviced</span>.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl disable serviced</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Reboot the host.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">reboot</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Log in to the delegate host <span class="ph">as <samp class="ph codeph">root</samp>, or as a user with superuser privileges</span>.</span>
                                       
                                    </li>
                                    
                                    
                                    <li class="li substep substepexpand">
                                       <span class="ph cmd">Enable the automatic startup of <span class="keyword cmdname">serviced</span>.</span>
                                       
                                       <div class="itemgroup stepxmp">
                                          <pre class="pre codeblock">systemctl enable serviced</pre>
                                          
                                          </div>
                                       
                                    </li>
                                    
                                    
                                 </ol>
                                 
                                 
                              </li>
                              
                           </ol>
                           
                           
                        </div>
                        
                        <div class="related-links"></div>
                     </div>
                     
                     <div class="row">
                        <footer id="topicsNPLinks">
                           <div id="footer_previous"><a href="../../feature/state/stop-n-master.html" class="previous" rel="internal" title="Stopping a master host (multi-host deployment)"><span class="fa fa-arrow-circle-o-left"></span><span class="sr-only">Stopping a master host (multi-host deployment)</span></a></div>
                           <div id="footer_next"><a href="../../feature/state/start-n.html" class="next" rel="internal" title="Starting Control Center (multi-host deployment)"><span class="sr-only">Starting Control Center (multi-host deployment)</span><span class="fa fa-arrow-circle-o-right"></span></a></div>
                        </footer>
                     </div>
                  </article>
                  <div class="clear"></div>
                  
               </div>
            </div>
         </div>
      </div>
   </body>
</html>