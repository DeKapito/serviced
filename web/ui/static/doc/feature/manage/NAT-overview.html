<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Using Control Center with a NAT device</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="reference">
      
      <meta name="DC.Title" content="Using Control Center with a NAT device">
      
      <meta name="DC.Relation" scheme="URI" content="admin.html">
      
      <meta name="prodname" content="Control Center">
      
      <meta name="prodname" content="Control Center">
      
      <meta name="version" content="1">
      
      <meta name="version" content="1">
      
      <meta name="release" content="3">
      
      <meta name="release" content="3">
      
      <meta name="modification" content="0">
      
      <meta name="modification" content="0">
      
      <meta name="DC.Publisher" content="Zenoss, Inc.">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="referenceid">
      <script type="text/javascript">var d4p = {"relativePath":"..\/..\/","dev":false,"debug":false,"draft":false,"nextTopicHref":"feature\/backup\/overview.html","previousTopicHref":"feature\/manage\/resize.html","root":false,"map":{"chunked":false},"search":{"minlength":2},"l":{"searchPageHeading":"Search Results","close":"Close"}}</script>
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../themes/html5-zenoss/css/style.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection, print" src="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
      <script rel="stylesheet" type="text/css" media="screen, projection, print" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../themes/html5-zenoss/js/script.js"></script>
      </head>
   <body class="en-us html5-zenoss centered navigation-default">
      <ul id="page-links" class="hidden sr-only">
         <li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li>
         <li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li>
         <li><a id="skip-to-footer" href="#footer">Skip to footer</a></li>
      </ul>
      <header id="site-head" class="header header--fixed">
         <nav id="topNav" class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">
               <div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="#">  Control Center Reference Guide  </a></div>
               <form id="search" class="navbar-form navbar-right hidden-xs" role="search">
                  <div class="form-group"><input id="search-text" type="text" class="form-control" placeholder="Search"></div>
               </form>
               <ul class="nav navbar-nav navbar-right hidden-xs"></ul>
            </div>
         </nav>
         <div id="msg-version"></div>
      </header>
      <div class="container">
         <div class="row">
            <div class="col-xs-12 col-md-21">
               <ol class="breadcrumb">
                  <li><a class="breadcrumb" href="../../feature/manage/admin.html" title="Administration reference">Administration reference</a></li>
                  
                  <li>Using Control Center with a NAT device</li>
               </ol>
            </div>
         </div>
         <div class="row">
            <div class="col-xs-6 col-md-4 hidden-xs">
               <nav id="side-navigation" class="bs-docs-sidebar hidden-print hidden-xs">
                  <ul class="nav bs-docs-sidenav">
                     <li class=" no-child "><a href="../../book/help/front/about.html">About this guide</a></li>
                     <li class=" collapsible  active"><a href="../../feature/manage/admin.html"><span class="enumeration enumeration0">Chapter 1. </span>Administration reference</a><ul class="nav">
                           <li class=" no-child "><a href="../../feature/manage/resize.html">Adding space to a tenant device</a></li>
                           <li class=" no-child  active"><a class="selected" href="../../feature/manage/NAT-overview.html">Using Control Center with a NAT device</a></li>
                           <li class=" collapsible  collapsed"><a href="../../feature/backup/overview.html">Backing up and restoring</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/backup/best-practice.html">Best practices for backup and restore</a></li>
                                 <li class=" no-child "><a href="../../feature/backup/backup.html">Backing up using the browser interface</a></li>
                                 <li class=" collapsible  collapsed"><a href="../../feature/backup/cli.html">Backing up using the CLI</a><ul class="nav">
                                       <li class=" no-child "><a href="../../feature/backup/cli-all.html">Backing up the entire system</a></li>
                                       <li class=" no-child "><a href="../../feature/backup/cli-exclude-one.html">Exclude one tenant volume from the backup</a></li>
                                       <li class=" no-child "><a href="../../feature/backup/cli-exclude-multiple.html">Exclude multiple tenant volumes from the backup</a></li>
                                    </ul>
                                 </li>
                                 <li class=" no-child "><a href="../../feature/backup/restore.html">Restoring from a backup</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/manage/snapshot-rollback.html">Snapshot and rollback</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/manage/snapshot.html">Creating a snapshot</a></li>
                                 <li class=" no-child "><a href="../../feature/manage/rollback.html">Rolling back to a snapshot</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/manage/intro-stop-start.html">Stopping and starting Control Center for maintenance</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/manage/stop-1.html">Stopping Control Center (single-host deployment)</a></li>
                                 <li class=" no-child "><a href="../../feature/manage/start-1.html">Starting Control Center (single-host deployment)</a></li>
                                 <li class=" collapsible  collapsed"><a href="../../feature/manage/stop-n.html">Stopping Control Center (multi-host deployment)</a><ul class="nav">
                                       <li class=" no-child "><a href="../../feature/manage/stop-n-master.html">Stopping a master host (multi-host deployment)</a></li>
                                       <li class=" no-child "><a href="../../feature/manage/stop-n-delegate.html">Stopping a delegate host (multi-host deployment)</a></li>
                                    </ul>
                                 </li>
                                 <li class=" no-child "><a href="../../feature/manage/start-n.html">Starting Control Center (multi-host deployment)</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/manage/emer-sdown-overview.html">Emergency shutdown of services</a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/manage/clear-emerg.html">Resetting emergency shutdown flags</a></li>
                              </ul>
                           </li>
                           <li class=" collapsible  collapsed"><a href="../../feature/manage/rolling-restart-overview.html">Rolling restart of services </a><ul class="nav">
                                 <li class=" no-child "><a href="../../feature/manage/change-rolling-restart.html">Changing rolling restart</a></li>
                              </ul>
                           </li>
                        </ul>
                     </li>
                     <li class=" collapsible  collapsed"><a href="../../feature/cli/cli.html"><span class="enumeration enumeration0">Chapter 2. </span>Command-line interface reference</a><ul class="nav">
                           <li class=" no-child "><a href="../../feature/cli/invoking-serviced.html">Invoking serviced</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced.html">serviced</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-backup.html">serviced backup</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-docker.html">serviced docker</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-host.html">serviced host</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-key.html">serviced key</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-log-export.html">serviced log export</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-pool.html">serviced pool</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-restore.html">serviced restore</a></li>
                           <li class=" no-child "><a href="../../feature/cli/script.html">serviced script</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-service.html">serviced service</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-snapshot.html">serviced snapshot</a></li>
                           <li class=" no-child "><a href="../../feature/cli/serviced-storage.html">serviced-storage</a></li>
                           <li class=" no-child "><a href="../../feature/vars/file.html">Control Center configuration file</a></li>
                        </ul>
                     </li>
                     <li class=" collapsible  collapsed"><a href="#">Glossary</a><ul class="nav">
                           <li class=" no-child "><a href="../../shared/glossary/cc-application.html">application</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-cluster.html">cluster</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-delegate-host.html">delegate host</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-master-host.html">master host</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-resource-pool.html">resource pool</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-service.html">service</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/service-definition.html">service definition</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/service-template.html">service template</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-serviced.html">serviced</a></li>
                           <li class=" no-child "><a href="../../shared/glossary/cc-tenant.html">tenant</a></li>
                        </ul>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="col-xs-12 col-md-8">
               <div id="page" class="starter-template">
                  <article>
                     <div class="page reference  - topic-topic       reference-reference " id="referenceid">
                        
                        <h1 class="title topictitle1">Using <span class="ph">Control Center</span> with a NAT device
                        </h1>
                        <div class="body refbody">
                           
                           <div class="section"><a name="referenceid-section_ggr_ccr_dz" id="referenceid-section_ggr_ccr_dz" class="anchor"></a>
                              
                              <p class="p">Network address translation (NAT) enables one device (a router, switch, or firewall) to
                                 connect a local area network with the internet and outside devices. The NAT device forwards
                                 traffic to the intended host, and serves as a firewall to systems that are behind the
                                 device, making them inaccessible from outside the network.
                              </p>
                              
                              
                              <p class="p">In a <span class="ph">Control Center</span> system without a NAT device, the master host connects directly to
                                 the delegate host's <span class="keyword apiname">address:rpcport</span> and requests host&nbsp;information.
                              </p>
                              
                              
                              <p class="p">When the <span class="ph">Control Center</span> master host is outside the network, it can connect to the NAT
                                 device, but cannot access delegate hosts behind the device because they have private IP
                                 addresses. The NAT device forwards its port to the delegate hosts'
                                 <span class="keyword apiname">address:rpcport</span>.
                              </p>
                              
                              
                           </div>
                           
                           
                           <div class="section"><a name="referenceid-section_ilt_kfr_dz" id="referenceid-section_ilt_kfr_dz" class="anchor"></a>
                              
                              <p class="p">When you add a delegate host by using either <span class="ph">Control Center</span> interface (browser or
                                 command-line) you must specify the hostname or IP address and port for the NAT device. After
                                 you add delegate hosts, you must transfer host keys to the delegate hosts and register
                                 them.
                              </p>
                              
                              
                              <p class="p">The <span class="ph">Control Center</span> master host always attempts registration on port 22. If the NAT
                                 device forwards port 22 to the delegate host that you are registering, you can remotely
                                 register the keys. 
                              </p>
                              
                              <pre class="pre codeblock">serviced host add <var class="keyword varname">Hostname-Or-IP</var>:<var class="keyword varname">Host-Port</var> \
    <span class="ph">--nat-address==<var class="keyword varname">NAT-Hostname-Or-IP</var>:<var class="keyword varname">NAT-Port</var></span> \
    [–register]</pre>
                              
                              </div>
                           
                           
                           <div class="section"><a name="referenceid-section_okz_m2r_dz" id="referenceid-section_okz_m2r_dz" class="anchor"></a>If you have two delegates behind the NAT device, change the
                              port forwarding for port 22 between adding the hosts, or transfer the keys file manually to
                              and register from each delegate.
                              <p class="p">When resetting keys, the CLI supports the
                                 <span class="keyword cmdname">--nat-address</span> argument. If the delegate is behind a NAT device and port
                                 22 is forwarded to that delegate, you can attempt to register the delegate when resetting
                                 the key:
                                 
                              </p>
                              <pre class="pre codeblock">serviced key reset <var class="keyword varname">Hostname-Or-IP</var>:<var class="keyword varname">Host-Port</var> --register \ 
    <span class="ph">--nat-address==<var class="keyword varname">NAT-Hostname-Or-IP</var>:<var class="keyword varname">NAT-Port</var></span></pre>
                              <h2 class="title sectiontitle">Example:
                                 Adding delegate hosts to a resource pool
                              </h2>
                              <div class="p">The master host is outside the network.
                                 Delegate hosts delegate1 and delegate2 are behind a NAT router. IP address and port
                                 information is as follow:
                                 <ul class="ul" id="referenceid__ul_x55_krr_dz">
                                    
                                    <li class="li">NAT router: 98.138.252.30</li>
                                    
                                    
                                    <li class="li">Delegate1: 192.168.22.100:4979</li>
                                    
                                    
                                    <li class="li">Delegate2: 192.168.22.101:4979</li>
                                    
                                    
                                 </ul>
                                 
                              </div>
                              
                              <div class="p">The router forwards port 4979 to delegate1's RPC port (4979):
                                 <pre class="pre codeblock">serviced host add 192.168.22.100:<strong class="ph b">4979</strong> <var class="keyword varname">Resource-Pool</var> \
    --nat-address=98.138.252.30:<strong class="ph b">4979</strong></pre>
                                 </div>
                              
                              <div class="p">The
                                 router forwards port 4980 to delegate2's RPC port
                                 (4979):<pre class="pre codeblock">serviced host add 192.168.22.101:<strong class="ph b">4979</strong> <var class="keyword varname">Resource-Pool</var> \
    --nat-address=98.138.252.30:<strong class="ph b">4980</strong> </pre>
                                 </div>
                              
                           </div>
                           
                           
                           <div class="section"><a name="referenceid-section_pyj_s2r_dz" id="referenceid-section_pyj_s2r_dz" class="anchor"></a>
                              
                              <h2 class="title sectiontitle">Security considerations for using <span class="ph">Control Center</span>with a NAT device
                              </h2>
                              
                              <p class="p">To attach to a service on a delegates behind the NAT device, you must use ssh to access the
                                 delegate. From the delegate host, run <span class="keyword cmdname">serviced service attach</span>. For
                                 security reasons, you cannot use <span class="keyword cmdname">serviced service attach</span> from the master
                                 to connect to a delegate. 
                              </p>
                              
                              
                              <p class="p">In the <span class="ph">Control Center</span> browser interface, for security reasons, you cannot drill down
                                 to a service that is running on a delegate behind a NAT device and click
                                 <span class="ph uicontrol">Container Log</span> for the instance
                              </p>
                              
                              
                           </div>
                           
                           
                        </div>
                        
                        <div class="related-links"></div>
                     </div>
                     
                     <div class="row">
                        <footer id="topicsNPLinks">
                           <div id="footer_previous"><a href="../../feature/manage/resize.html" class="previous" rel="internal" title="Adding space to a tenant device"><span class="fa fa-arrow-circle-o-left"></span><span class="sr-only">Adding space to a tenant device</span></a></div>
                           <div id="footer_next"><a href="../../feature/backup/overview.html" class="next" rel="internal" title="Backing up and restoring"><span class="sr-only">Backing up and restoring</span><span class="fa fa-arrow-circle-o-right"></span></a></div>
                        </footer>
                     </div>
                  </article>
                  <div class="clear"></div>
                  
               </div>
            </div>
         </div>
      </div>
   </body>
</html>