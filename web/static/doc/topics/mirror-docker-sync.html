<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2014">
<meta name="DC.rights.owner" content="(C) Copyright 2014">
<meta name="DC.Type" content="task">
<meta name="prodname" content="Control Center">
<meta name="version" content="0">
<meta name="release" content="8">
<meta name="modification" content="0">
<meta name="DC.Publisher" content="Zenoss, Inc.">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="taskid">
<link rel="stylesheet" type="text/css" href="../commonltr.css">
<title>Mirroring with synchronous internet and master host access</title>
</head>
<body id="taskid">


  <h1 class="title topictitle1">Mirroring with synchronous internet and master host access</h1>

  <div class="body taskbody">
    <ol class="ol steps"><li class="li step stepexpand">
        <span class="ph cmd">Log in to the transfer host <span class="ph">as a user with <samp class="ph codeph">sudo</samp> and <samp class="ph codeph">docker</samp> privileges</span>.</span>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Copy the service definition template file from the 
          <span class="ph">Control Center</span> master host to the transfer host.</span>
        <div class="itemgroup stepxmp"><pre class="pre codeblock">scp <var class="keyword varname">Master-Host-FQDN</var>:/opt/serviced/templates/<var class="keyword varname">Template</var>.json .</pre>
</div>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Invoke the mirror script.</span>
        <div class="itemgroup stepxmp"><pre class="pre codeblock">./template-mirror.py ./<var class="keyword varname">Template</var>.json <var class="keyword varname">Master-Host-FQDN</var>:5000 \
  ./<var class="keyword varname">Template</var>_<var class="keyword varname">Master-Host-FQDN</var>.json</pre>
</div>
        <div class="itemgroup info">
          <p class="p">The mirror script</p>

          <ol class="ol" type="a">
            <li class="li">pulls the Docker images listed in the original template into a Docker index on the transfer host</li>

            <li class="li">pushes the images in the local index to the Docker registry on the <span class="ph">Control Center</span> master host</li>

            <li class="li">tags the images on the master host with the FQDN of the master host</li>

            <li class="li">creates a new template, referencing the new image tags</li>

          </ol>

        </div>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Copy the new template to the master host.</span>
        <div class="itemgroup stepxmp"><pre class="pre codeblock">scp ./<var class="keyword varname">Template</var>_<var class="keyword varname">Master-Host-FQDN</var>.json \
  <var class="keyword varname">Master-Host-FQDN</var>:/opt/serviced/templates</pre>
</div>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Log in to the <span class="ph">Control Center</span> master host
          <span class="ph">as a user with <samp class="ph codeph">sudo</samp> and <samp class="ph codeph">docker</samp> privileges</span>.</span>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Remove the template added when <span class="keyword cmdname">serviced</span> was installed.</span>
        <div class="itemgroup stepxmp"><pre class="pre codeblock">ID=$(serviced template list | tail -1 | awk '{ print $1 }'); echo $ID
serviced template remove $ID</pre>
</div>
      </li>
<li class="li step stepexpand">
        <span class="ph cmd">Add the new template to <span class="ph">Control Center</span>.</span>
        <div class="itemgroup stepxmp"><pre class="pre codeblock">serviced template add \
  /opt/serviced/templates/<var class="keyword varname">Template</var>_<var class="keyword varname">Master-Host-FQDN</var>.json</pre>
</div>
        <div class="itemgroup info">This step makes the new template available for deployment in the <span class="ph">Control Center</span>
        web interface.</div>
      </li>
</ol>

  </div>


</body>
</html>