#! /bin/bash

# serviced run SERVICE COMMAND ARGS

# serviced shell SERVICE -snapshot TAGNAME $SERVICED_BIN/.run COMMAND ARGS
# if exitcode == TX_COMMIT; do commit
# if exitcode == TX_ROLLBACK; do rollback
# else remove container

# Check the args


if test $# -lt 2; then
    echo -e "Missing program argument" >&2
    exit -1
fi

PROGRAM=$1
shift; ARGS=$@

# Source the data
if ls $SERVICED_BIN/$PROGRAM > /dev/null; then
    source $SERVICED_BIN/$PROGRAM
else
    echo -e "Program not found: $PROGRAM" >&2
    exit -2
fi

# Look up the command
if declare -f $ARGS[0] > /dev/null; then
    $ARGS
else
    __DEFAULT__ $ARGS
fi

exit $?
